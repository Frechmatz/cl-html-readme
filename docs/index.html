<html><body><header><h1>cl-html-readme</h1>A Documentation Generator for Common Lisp projects. The key concepts are as follows:
<ul>
    <li>The generated documentation consists of HTML files.</li>
    <li>Docstrings are using HTML as markup language.</li>
    <li>Adding verbatim HTML to the documentation via plain strings or HTML files.</li>
    <li>Easy adding of source code files to the documentation.</li>
    <li>Generation of HTML headings, a Table Of Contents and HTML semantic elements via a DSL.</li>
    <li>No wrapping of the <a href="http://www.lispworks.com/documentation/lw50/CLHS/Body/f_docume.htm">documentation</a> function.</li>
    <li>Keeping predefined HTML markup at a minimum.</li>
</ul><p>The source code is available <a href="https://github.com/Frechmatz/cl-html-readme">here</a>.</p></header><nav><h1>Table of contents</h1><ul><li><a href="#Installation">Installation</a></li><li><a href="#DSL">DSL</a><ul><li><a href="#Example: Heading elements and Table of Contents">Example: Heading elements and Table of Contents</a></li><li><a href="#Example: Semantic elements">Example: Semantic elements</a></li><li><a href="#Example: Classes and Styling">Example: Classes and Styling</a></li></ul></li><li><a href="#API">API</a></li><li><a href="#Complete Readme-Generation example">Complete Readme-Generation example</a></li></ul></nav><section><h1 id="Installation">Installation</h1><pre><code>
cd ~/quicklisp/local-projects
git clone https://github.com/Frechmatz/cl-html-readme.git
</code></pre><h1 id="DSL">DSL</h1><p>TODO Introduction.</p><h2 id="Example: Heading elements and Table of Contents">Example: Heading elements and Table of Contents</h2><h3>DSL</h3><p><pre><code>((heading (:name "Example"))
 (heading (:name "Table of contents")
          (toc))
 (heading (:name "Chapter 1" :toc t)) "Lorem ipsum"
 (heading (:name "Chapter 2" :toc t)) "Lorem ipsum")))</code></pre></p><h3>Generated HTML</h3><p><pre><code>&lt;h1&gt;Example
&lt;/h1&gt;
&lt;h1&gt;Table of contents
&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;a href="#Chapter 1"&gt;Chapter 1
    &lt;/a&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;a href="#Chapter 2"&gt;Chapter 2
    &lt;/a&gt;
  &lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="Chapter 1"&gt;Chapter 1
&lt;/h1&gt;Lorem ipsum
&lt;h1 id="Chapter 2"&gt;Chapter 2
&lt;/h1&gt;Lorem ipsum</code></pre></p><h2 id="Example: Semantic elements">Example: Semantic elements</h2><h3>DSL</h3><p><pre><code>((semantic (:name "header")
           (heading (:name "Example")))
 (semantic (:name "nav")
           (heading (:name "Table of contents")
                    (toc)))
 (semantic (:name "section")
           (heading (:name "Chapter 1" :toc t))
           "Lorem ipsum"
           (heading (:name "Chapter 2" :toc t))
           "Lorem ipsum")
 (semantic (:name "footer") "Lorem ipsum"))</code></pre></p><h3>Generated HTML</h3><p><pre><code>&lt;header&gt;
  &lt;h1&gt;Example
  &lt;/h1&gt;
&lt;/header&gt;
&lt;nav&gt;
  &lt;h1&gt;Table of contents
  &lt;/h1&gt;
  &lt;ul&gt;
    &lt;li&gt;
      &lt;a href="#Chapter 1"&gt;Chapter 1
      &lt;/a&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;a href="#Chapter 2"&gt;Chapter 2
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/nav&gt;
&lt;section&gt;
  &lt;h1 id="Chapter 1"&gt;Chapter 1
  &lt;/h1&gt;Lorem ipsum
  &lt;h1 id="Chapter 2"&gt;Chapter 2
  &lt;/h1&gt;Lorem ipsum
&lt;/section&gt;
&lt;footer&gt;Lorem ipsum
&lt;/footer&gt;</code></pre></p><h2 id="Example: Classes and Styling">Example: Classes and Styling</h2><p>Work in progress...</p><h3>DSL</h3><p><pre><code>((semantic (:name "header" :class "semantic-header-class" :style "semantic-header-style" )
           (heading (:name "Example" :class "example-class" :style "example-style")))
 (semantic (:name "nav")
           (heading (:name "Table of contents")
                    (toc)))
 (semantic (:name "section")
           (heading (:name "Chapter 1" :toc t :class "chapter-1-class" :style "chapter-1-style" :toc-class "chapter-1-toc-class" :toc-style "chapter-1-toc-style"))
           "Lorem ipsum"
           (heading (:name "Chapter 2" :toc t))
           "Lorem ipsum")
 (semantic (:name "footer") "Lorem ipsum"))))</code></pre></p><h3>Generated HTML</h3><p><pre><code>&lt;header class="semantic-header-class" style="semantic-header-style"&gt;
  &lt;h1 class="example-class" style="example-style"&gt;Example
  &lt;/h1&gt;
&lt;/header&gt;
&lt;nav&gt;
  &lt;h1&gt;Table of contents
  &lt;/h1&gt;
  &lt;ul&gt;
    &lt;li class="chapter-1-toc-class" style="chapter-1-toc-style"&gt;
      &lt;a href="#Chapter 1"&gt;Chapter 1
      &lt;/a&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;a href="#Chapter 2"&gt;Chapter 2
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/nav&gt;
&lt;section&gt;
  &lt;h1 id="Chapter 1" class="chapter-1-class" style="chapter-1-style"&gt;Chapter 1
  &lt;/h1&gt;Lorem ipsum
  &lt;h1 id="Chapter 2"&gt;Chapter 2
  &lt;/h1&gt;Lorem ipsum
&lt;/section&gt;
&lt;footer&gt;Lorem ipsum
&lt;/footer&gt;</code></pre></p><h1 id="API">API</h1><b>*home-directory*</b><p>Home directory of the project for which documentation is to be generated.</p><b>*tab-width*</b><p>Width of a tab. Used, when tabs are to be replaced with space characters.</p><b>make-path</b>&nbsp;(path)<p>Creates a path relative to *home-directory*. The function has the following arguments:
   <ul>
      <li>path The path, e.g. examples/example-1.lisp.</li>
   </ul></p><b>read-file</b>&nbsp;(path &key (replace-tabs nil) (escape nil))<p>Reads a text file and returns it as a string. The function has the following arguments:
   <ul>
      <li>path Path of the file relative to *home-directory*.</li>
      <li>:replace-tabs If t then tabs are replaced with spaces according to the *tab-width* variable.</li>
      <li>:escape If t then special characters are replaced with HTML character entities.</li>
   </ul></p><h1 id="Complete Readme-Generation example">Complete Readme-Generation example</h1><p>TODO Introduction. The example uses the docparser library for extraction of docstrings.</p><p><pre><code>(in-package :cl-html-readme-make-readme)

;;
;; Helper functions
;;

(defun get-node (index package-name symbol-name)
  (aref (docparser:query
         index
         :package-name (string-upcase package-name)
         :symbol-name (string-upcase symbol-name))
        0))
  
(defun make-function-string (index package-name symbol-name)
  (let* ((node (get-node index package-name symbol-name))
         (lambda-list (docparser:operator-lambda-list node)))
    (concatenate
     'string
     "&lt;b&gt;" (string-downcase symbol-name) "&lt;/b&gt;&amp;nbsp;"
     (string-downcase (format nil "~a" (if lambda-list lambda-list "()")))
     "&lt;p&gt;" (docparser:node-docstring node) "&lt;/p&gt;")))

(defun make-variable-string (index package-name symbol-name)
  (let ((node (get-node index package-name symbol-name)))
    (concatenate
     'string
     "&lt;b&gt;" (string-downcase symbol-name) "&lt;/b&gt;"
     "&lt;p&gt;" (docparser:node-docstring node) "&lt;/p&gt;")))
  
(defun make-code-string (path)
  (concatenate
   'string
   "&lt;p&gt;&lt;pre&gt;&lt;code&gt;"
   (cl-html-readme:read-file path :replace-tabs t :escape t)
   "&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;"))

(defun now ()
  "Returns a string representing the current date and time."
  (multiple-value-bind (sec min hr day mon yr dow dst-p tz)
      (get-decoded-time)
    (declare (ignore dow dst-p tz))
    ;; 2018-09-19 21:28:16
    (let ((str (format nil "~4,'0d-~2,'0d-~2,'0d  ~2,'0d:~2,'0d:~2,'0d" yr mon day hr min sec)))
      str)))

;;
;; Readme
;;

(defun get-readme (index)
    `("&lt;html&gt;&lt;body&gt;"
      (semantic (:name "header")
                (heading (:name "cl-html-readme"))
                ,(cl-html-readme:read-file "make-readme/introduction.html")
                "&lt;p&gt;The source code is available &lt;a href=\"https://github.com/Frechmatz/cl-html-readme\"&gt;here&lt;/a&gt;.&lt;/p&gt;")
      (semantic (:name "nav")
                (heading (:name "Table of contents")
                         (toc)))
      (semantic (:name "section")
                (heading (:name "Installation" :toc t)
                         ,(cl-html-readme:read-file "make-readme/installation.html"))
                (heading (:name "DSL" :toc t)
                         "&lt;p&gt;TODO Introduction.&lt;/p&gt;"
                         (heading (:name "Example: Heading elements and Table of Contents" :toc t)
                                  (heading (:name "DSL")
                                           ,(make-code-string "make-readme/dsl-example-plain.dsl"))
                                  (heading (:name "Generated HTML")
                                           ,(make-code-string "make-readme/dsl-example-plain.html")))
                         (heading (:name "Example: Semantic elements" :toc t)
                                  (heading (:name "DSL")
                                           ,(make-code-string "make-readme/dsl-example-semantic.dsl"))
                                  (heading (:name "Generated HTML")
                                           ,(make-code-string "make-readme/dsl-example-semantic.html")))
                         (heading (:name "Example: Classes and Styling" :toc t)
                                  "&lt;p&gt;Work in progress...&lt;/p&gt;"
                                  (heading (:name "DSL")
                                           ,(make-code-string "make-readme/dsl-example-styling.dsl"))
                                  (heading (:name "Generated HTML")
                                           ,(make-code-string "make-readme/dsl-example-styling.html"))))
                (heading (:name "API":toc t)
                         ,(make-variable-string index "cl-html-readme" "*home-directory*")
                         ,(make-variable-string index "cl-html-readme" "*tab-width*")
                         ,(make-function-string index "cl-html-readme" "make-path")
                         ,(make-function-string index "cl-html-readme" "read-file"))
                (heading (:name "Complete Readme-Generation example" :toc t)
                         "&lt;p&gt;TODO Introduction. The example uses the docparser library for extraction of docstrings.&lt;/p&gt;"
                         ,(make-code-string "make-readme/make-readme.lisp")))
      (semantic (:name "footer")
                "&lt;hr/&gt;&lt;p&gt;&lt;small&gt;Generated " ,(now) "&lt;/small&gt;&lt;/p&gt;")
      "&lt;/body&gt;&lt;/html&gt;"))

;;
;; Generate readme
;;

(defun make-readme ()
  (let ((index (docparser:parse :cl-html-readme)))
    (let ((cl-html-readme:*home-directory* (asdf:system-source-directory :cl-html-readme-make-readme)))
      (with-open-file (fh (cl-html-readme:make-path "docs/index.html")
                          :direction :output
                          :if-exists :supersede
                          :if-does-not-exist :create
                          :external-format :utf-8)
        (cl-html-readme:doc-to-html fh (get-readme index)))))
    "DONE")

;;(make-readme)</code></pre></p></section><footer><hr/><p><small>Generated 2020-11-12  23:45:40</small></p></footer></body></html>